name: Wake Up Apps

on:
  schedule:
    - cron: '0 */2 * * *'
  workflow_dispatch:

jobs:
  wake-up:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install playwright
          playwright install chromium

      - name: Run Wake Up Script
        run: |
          python - <<EOF
          from playwright.sync_api import sync_playwright
          import time

          urls = [
              "https://recruitment-dashboard-ipmsabadgebtsi8nsngina.streamlit.app/",
              "https://recruitment-dashboard-kyhnhmdicnr6qjeamripzs.streamlit.app/"
          ]

          with sync_playwright() as p:
              browser = p.chromium.launch(headless=True)
              for url in urls:
                  print(f"正在尝试唤醒: {url}")
                  page = browser.new_page()
                  try:
                      page.goto(url, wait_until="networkidle", timeout=60000)
                      # 查找并点击那张图片或按钮
                      button = page.get_by_text("Yes, get this app back up!")
                      if button.is_visible():
                          button.click()
                          print(f"检测到睡眠状态，已点击唤醒按钮。")
                          time.sleep(10) # 等待几秒让它启动
                      else:
                          print(f"应用似乎是清醒的。")
                  except Exception as e:
                      print(f"访问出错: {e}")
                  page.close()
              browser.close()
          EOF
